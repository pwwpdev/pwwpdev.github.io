<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smplrspace Viewer</title>
    <!-- Load smplr.js and its styles -->
  </head>
  <body>
    <script src="https://app.smplrspace.com/lib/smplr.js"></script>
    <link href="https://app.smplrspace.com/lib/smplr.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <div id="wrapper">
      <div id="smplrspace-container"></div>
    </div>

    <script>
      const API_ENDPOINT =
        "https://optimusc.flowfuse.cloud/lingnan-library-dos";

      const CLIENT_ID = "pub_45cf413215bd43f79621e0b28f8a815b";
      const SPACE_ID = "73242c82-a0e9-4c96-8d28-089829ecf3d0";

      const UPDATE_FREQUENCY = 60;

      const desk_index = {
        "LRT01-S01": 0,
        "LRT01-S02": 1,
        "LRT01-S03": 2,
        "LRT01-S04": 3,
        "LRT01-S05": 4,
        "LRT01-S06": 5,
        "LRT01-S07": 6,
        "LRT01-S08": 7,
        "LRT01-S09": 8,
        "LRT01-S10": 9,
        "LRT02-S01": 10,
        "LRT02-S02": 11,
        "LRT02-S03": 12,
        "LRT02-S04": 13,
        "LRT02-S05": 14,
        "LRT02-S06": 15,
        "LRT02-S07": 16,
        "LRT02-S08": 17,
        "LRT02-S09": 18,
        "LRT02-S10": 19,
        "LRT03-S01": 20,
        "LRT03-S02": 21,
        "LRT03-S03": 22,
        "LRT03-S04": 23,
        "LRT03-S05": 24,
        "LRT03-S06": 25,
        "LRT03-S07": 26,
        "LRT03-S08": 27,
        "LRT03-S09": 28,
        "LRT03-S10": 29,
        "LRT04-S01": 30,
        "LRT04-S02": 31,
        "LRT04-S03": 32,
        "LRT04-S04": 33,
        "LRT04-S05": 34,
        "LRT04-S06": 35,
        "LRT04-S07": 36,
        "LRT04-S08": 37,
        "LRT04-S09": 38,
        "LRT04-S10": 39,
        "LRT05-S01": 40,
        "LRT05-S02": 41,
        "LRT05-S03": 42,
        "LRT05-S04": 43,
        "LRT05-S05": 44,
        "LRT05-S06": 45,
        "LRT05-S07": 46,
        "LRT05-S08": 47,
        "LRT05-S09": 48,
        "LRT05-S10": 49,
        "LRT06-S01": 50,
        "LRT06-S02": 51,
        "LRT06-S03": 52,
        "LRT06-S04": 53,
        "LRT06-S05": 54,
        "LRT06-S06": 55,
        "LRT06-S07": 56,
        "LRT06-S08": 57,
        "LRT06-S09": 58,
        "LRT06-S10": 59,
        "1FN-S01": 60,
        "1FN-S02": 61,
        "1FN-S03": 62,
        "1FN-S04": 63,
        "1FN-S05": 64,
        "1FS-S01": 65,
        "1FS-S02": 66,
        "1FS-S03": 67,
        "1FS-S04": 68,
        "1FS-S05": 69
          };

      const desk_filter = {
        "LRT01-S01": "LRT01-S01",
        "LRT01-S02": "LRT01-S02",
        "LRT01-S03": "LRT01-S03",
        "LRT01-S04": "LRT01-S04",
        "LRT01-S05": "LRT01-S05",
        "LRT01-S06": "LRT01-S06",
        "LRT01-S07": "LRT01-S07",
        "LRT01-S08": "LRT01-S08",
        "LRT01-S09": "LRT01-S09",
        "LRT01-S10": "LRT01-S10",
        "LRT02-S01": "LRT02-S01",
        "LRT02-S02": "LRT02-S02",
        "LRT02-S03": "LRT02-S03",
        "LRT02-S04": "LRT02-S04",
        "LRT02-S05": "LRT02-S05",
        "LRT02-S06": "LRT02-S06",
        "LRT02-S07": "LRT02-S07",
        "LRT02-S08": "LRT02-S08",
        "LRT02-S09": "LRT02-S09",
        "LRT02-S10": "LRT02-S10",
        "LRT03-S01": "LRT03-S01",
        "LRT03-S02": "LRT03-S02",
        "LRT03-S03": "LRT03-S03",
        "LRT03-S04": "LRT03-S04",
        "LRT03-S05": "LRT03-S05",
        "LRT03-S06": "LRT03-S06",
        "LRT03-S07": "LRT03-S07",
        "LRT03-S08": "LRT03-S08",
        "LRT03-S09": "LRT03-S09",
        "LRT03-S10": "LRT03-S10",
        "LRT04-S01": "LRT04-S01",
        "LRT04-S02": "LRT04-S02",
        "LRT04-S03": "LRT04-S03",
        "LRT04-S04": "LRT04-S04",
        "LRT04-S05": "LRT04-S05",
        "LRT04-S06": "LRT04-S06",
        "LRT04-S07": "LRT04-S07",
        "LRT04-S08": "LRT04-S08",
        "LRT04-S09": "LRT04-S09",
        "LRT04-S10": "LRT04-S10",
        "LRT05-S01": "LRT05-S01",
        "LRT05-S02": "LRT05-S02",
        "LRT05-S03": "LRT05-S03",
        "LRT05-S04": "LRT05-S04",
        "LRT05-S05": "LRT05-S05",
        "LRT05-S06": "LRT05-S06",
        "LRT05-S07": "LRT05-S07",
        "LRT05-S08": "LRT05-S08",
        "LRT05-S09": "LRT05-S09",
        "LRT05-S10": "LRT05-S10",
        "LRT06-S01": "LRT06-S01",
        "LRT06-S02": "LRT06-S02",
        "LRT06-S03": "LRT06-S03",
        "LRT06-S04": "LRT06-S04",
        "LRT06-S05": "LRT06-S05",
        "LRT06-S06": "LRT06-S06",
        "LRT06-S07": "LRT06-S07",
        "LRT06-S08": "LRT06-S08",
        "LRT06-S09": "LRT06-S09",
        "LRT06-S10": "LRT06-S10",
        "1FN-S01": "1FN-S01",
        "1FN-S02": "1FN-S02",
        "1FN-S03": "1FN-S03",
        "1FN-S04": "1FN-S04",
        "1FN-S05": "1FN-S05",
        "1FS-S01": "1FS-S01",
        "1FS-S02": "1FS-S02",
        "1FS-S03": "1FS-S03",
        "1FS-S04": "1FS-S04",
        "1FS-S05": "1FS-S05"
      };

      const room_index = {
        "Group Study Room 9": 0,
        "Individual Study Room 1": 1,
        "Individual Study Room 2": 2,
        "Individual Study Room 3": 3,
        "Group Study Room 8": 4,
        
      };

      const room_filter = {
        "1FC-GS9": "Group Study Room 9",
        "1FC-IS1": "Individual Study Room 1",
        "1FC-IS2": "Individual Study Room 2",
        "1FC-IS3": "Individual Study Room 3",
        "1FC-GS8": "Group Study Room 8",
      };

      // Updated for new color overlays
        const color_overlay_index = {
        "1": 0,
        "2": 1,
        "3": 2,
        "Study1": 3,
        "Study2": 4,
        "Study3": 5
        };

        const color_overlay_filter = {
        "1FC-UA1": "1",
        "1FC-UA2": "2", 
        "1FC-UA3": "3",
        "1FC-IS1": "Study1",
        "1FC-IS2": "Study2",
        "1FC-IS3": "Study3"
        };

      const dict = [
        {
          id: "97bb9348-8841-42ea-91f2-f0589f05473c",
          name: "LRR Desk",
          type: "furniture",
          assets: [
            {
              id: "2a4af663-0eee-42b1-a569-5ac13b4daae3",
              name: "LRT01-S01",
              furnitureId: "51d6eb0c-930c-4feb-8c8f-e39b2db2ffee",
              layerType: "furniture",
            },
            {
              id: "c25407a9-69e2-4580-9baa-cd3037801a8d",
              name: "LRT01-S02",
              furnitureId: "507326d2-077a-4135-accb-40eb588c3ef9",
              layerType: "furniture",
            },
            {
              id: "4c59265f-81ba-4256-99b7-1d3e9c91db93",
              name: "LRT01-S03",
              furnitureId: "f526ce1c-570f-43b7-aae5-1207bb1f43ab",
              layerType: "furniture",
            },
            {
              id: "a7051fac-2793-4047-b5ea-dc2335276b14",
              name: "LRT01-S04",
              furnitureId: "7d12c239-b79a-4ff7-bde2-252453c739ae",
              layerType: "furniture",
            },
            {
              id: "e8b5f525-4447-40ba-9e03-f0513b96ed89",
              name: "LRT01-S05",
              furnitureId: "6920090d-50cc-4f2c-bcf7-416c1db91fce",
              layerType: "furniture",
            },
            {
              id: "5613a796-9986-4075-bfae-770e70736b80",
              name: "LRT01-S06",
              furnitureId: "f686ca38-d98b-4f06-b570-9ea4552bce68",
              layerType: "furniture",
            },
            {
              id: "34ca1218-0977-462a-9365-5bb409b63185",
              name: "LRT01-S07",
              furnitureId: "d3e1902e-ae77-41cf-9663-7a101f3e6399",
              layerType: "furniture",
            },
            {
              id: "0994c26f-6749-4909-896d-17bf227fca25",
              name: "LRT01-S08",
              furnitureId: "6178b0d1-99c4-4652-990e-12f8bac8658f",
              layerType: "furniture",
            },
            {
              id: "61855b20-8359-486a-ab92-e51e2347e645",
              name: "LRT01-S09",
              furnitureId: "dc50398d-a6f8-4c43-8ca9-badb08cd1603",
              layerType: "furniture",
            },
            {
              id: "4e4f525c-8540-45d1-a3ee-1f646353ffd3",
              name: "LRT01-S10",
              furnitureId: "a9962b6b-26ce-436a-9af5-0f73b1f88d98",
              layerType: "furniture",
            },
            {
              id: "ca314bfd-6190-4f03-8d58-e1ef1007ade6",
              name: "LRT02-S01",
              furnitureId: "e7860d0a-4d66-4f4d-9c6b-7d30ac8de382",
              layerType: "furniture",
            },
            {
              id: "a6e8f32c-ca3e-43fb-a937-60a84bf400ca",
              name: "LRT02-S02",
              furnitureId: "7909d6d8-221c-476f-921d-e910d8c1264b",
              layerType: "furniture",
            },
            {
              id: "7dbffb04-1264-405a-b61a-26ad9deff4b2",
              name: "LRT02-S03",
              furnitureId: "7c97bb4b-b99f-4d23-a796-f5f9eb84620b",
              layerType: "furniture",
            },
            {
              id: "4cef2109-693d-4ac8-b6de-108dcee4af37",
              name: "LRT02-S04",
              furnitureId: "aabc277b-7a91-4057-ae5f-013e6179974a",
              layerType: "furniture",
            },
            {
              id: "67325ee2-a533-443f-a23e-721ee071de50",
              name: "LRT02-S05",
              furnitureId: "79b7e004-9575-43a1-8abf-2e99d6be655c",
              layerType: "furniture",
            },
            {
              id: "c5f8d077-e848-4cdf-a4d3-0c9d0f2a3bc4",
              name: "LRT02-S06",
              furnitureId: "fb7e3f21-4141-4fba-bdb5-77ea9effe175",
              layerType: "furniture",
            },
            {
              id: "d41dc8c6-a716-479d-bd29-5b3602794750",
              name: "LRT02-S07",
              furnitureId: "3c568152-7874-4439-9213-cbcb48aca31f",
              layerType: "furniture",
            },
            {
              id: "3ae03ab5-5179-41c2-9060-9c05ef6ba3ff",
              name: "LRT02-S08",
              furnitureId: "7e71c43c-3674-45c5-9367-3d92b8ca90fb",
              layerType: "furniture",
            },
            {
              id: "cf2cc9a6-2f63-41d4-9f91-449455cf1f2b",
              name: "LRT02-S09",
              furnitureId: "8e6aeec2-19f4-4f98-bb4e-4d12bb2c79dd",
              layerType: "furniture",
            },
            {
              id: "a0b88db3-cf40-4390-8e21-4362a0070a56",
              name: "LRT02-S10",
              furnitureId: "ab10d1ff-210d-4318-934e-c7c42fbabad4",
              layerType: "furniture",
            },
            {
              id: "1fff8614-28d8-471b-804d-7c729a87b79c",
              name: "LRT03-S01",
              furnitureId: "73e36729-5c27-4c04-aebf-a42d613d87fd",
              layerType: "furniture",
            },
            {
              id: "dcd0d6e6-9376-4a2c-a8b0-ced2238fd870",
              name: "LRT03-S02",
              furnitureId: "43a6e8b2-9ba3-474e-aff2-7549605c9b6a",
              layerType: "furniture",
            },
            {
              id: "e1b9ce38-d03e-41eb-80c6-ea3e808627e2",
              name: "LRT03-S03",
              furnitureId: "c6846a03-b76f-4387-ac11-ec8c06c90fcf",
              layerType: "furniture",
            },
            {
              id: "69b1a8e5-cdb7-49e4-810e-dfb1e438c90e",
              name: "LRT03-S04",
              furnitureId: "b5621b3c-8efc-4455-ac19-e003a0ae1cee",
              layerType: "furniture",
            },
            {
              id: "40f35036-373f-4640-84a1-cebab2788bb2",
              name: "LRT03-S05",
              furnitureId: "6cff29c6-ec8f-4be0-811a-057de9dbc74a",
              layerType: "furniture",
            },
            {
              id: "95c7395a-1742-4153-9e77-db2b365bbfdc",
              name: "LRT03-S06",
              furnitureId: "191ee9ff-678c-4ba1-a39b-31bca6d5c36d",
              layerType: "furniture",
            },
            {
              id: "0455a87f-e3bc-4679-860d-b8fee335af48",
              name: "LRT03-S07",
              furnitureId: "2543a1f7-412c-4ddf-93a5-ed07e5c9d898",
              layerType: "furniture",
            },
            {
              id: "3a4d5d94-5910-457c-b02f-794cfa2f1bf9",
              name: "LRT03-S08",
              furnitureId: "5d3f14e1-2f29-486a-9ece-247787869aa7",
              layerType: "furniture",
            },
            {
              id: "5de0c526-bed0-407a-88e0-d335408284f9",
              name: "LRT03-S09",
              furnitureId: "b4735137-e041-416f-b123-bdc259eaa843",
              layerType: "furniture",
            },
            {
              id: "f419d856-4d56-48ed-a44d-b296017af2cd",
              name: "LRT03-S10",
              furnitureId: "be402c15-4498-47d8-880a-b32e7def61f3",
              layerType: "furniture",
            },
            {
              id: "9ab7041d-f45d-4736-b5ce-e669dfb6313b",
              name: "LRT04-S01",
              furnitureId: "70bd46dc-0e00-4188-a9ba-894c1497bbbe",
              layerType: "furniture",
            },
            {
              id: "c3432109-cf33-4a29-bff7-bbfd9632f148",
              name: "LRT04-S02",
              furnitureId: "d519eaf2-5f9a-4edd-a7fe-d80906efc40a",
              layerType: "furniture",
            },
            {
              id: "e563b7bf-e688-4fe6-aff3-b60b2f98b2f2",
              name: "LRT04-S03",
              furnitureId: "974896da-5a83-40e9-982e-97ef85fe2456",
              layerType: "furniture",
            },
            {
              id: "a95be06c-fd42-46cd-924e-83136442b31b",
              name: "LRT04-S04",
              furnitureId: "08ca4067-6c2c-4c19-b5a1-5fc6b2ee5061",
              layerType: "furniture",
            },
            {
              id: "100af926-5529-46b2-bb15-d94b72c6b4c7",
              name: "LRT04-S05",
              furnitureId: "19093d2c-b06a-41fe-9e2d-ef3e4a7fe43e",
              layerType: "furniture",
            },
            {
              id: "de64f929-9530-49de-a37e-faa676f178dc",
              name: "LRT04-S06",
              furnitureId: "b06add29-dba6-41df-bcb3-e76061162d69",
              layerType: "furniture",
            },
            {
              id: "e14e617f-0a1e-4411-8111-429ad2e8045f",
              name: "LRT04-S07",
              furnitureId: "148a5a19-e567-487a-a25c-9bf512183642",
              layerType: "furniture",
            },
            {
              id: "dd3758d1-c6a8-4489-89fb-2814c784c5d5",
              name: "LRT04-S08",
              furnitureId: "2ddf9be5-8d15-4af6-9229-f5c858e07b69",
              layerType: "furniture",
            },
            {
              id: "5854e452-a9b7-4e36-97b9-a1320734656a",
              name: "LRT04-S09",
              furnitureId: "46c3ded6-53b4-4636-b617-b604b2d10a42",
              layerType: "furniture",
            },
            {
              id: "d1b91ecc-eda2-4674-a263-c3a17dc4de24",
              name: "LRT04-S10",
              furnitureId: "418657a0-1922-476d-bb2c-e8ca14266958",
              layerType: "furniture",
            },
            {
              id: "39964306-eb35-4745-bdd0-3e2eb9603b5a",
              name: "LRT05-S01",
              furnitureId: "6eb1e034-169c-4f8c-952d-9576b92de369",
              layerType: "furniture",
            },
            {
              id: "49be04c0-6eb7-4663-bd86-aa3f882e6c0b",
              name: "LRT05-S02",
              furnitureId: "ec9782fa-db9e-4af0-8fcd-cbd9b29b40bf",
              layerType: "furniture",
            },
            {
              id: "b7771164-3ceb-479b-9659-8a48e0f38586",
              name: "LRT05-S03",
              furnitureId: "a3727d19-f033-49c6-ac5c-3c0c5de31c75",
              layerType: "furniture",
            },
            {
              id: "c6d2d8d2-b760-49d0-bbac-564c2c48ea73",
              name: "LRT05-S04",
              furnitureId: "712ffe41-b9cb-413b-ad43-5398ba17e414",
              layerType: "furniture",
            },
            {
              id: "091a782f-ffda-4649-b609-aadb0b64a5d8",
              name: "LRT05-S05",
              furnitureId: "1948ff48-0752-458d-aea4-7a9453b19a48",
              layerType: "furniture",
            },
            {
              id: "07f7eff6-d6a0-43ad-b128-b619275f87ee",
              name: "LRT05-S06",
              furnitureId: "8a4bc8f3-0b98-4a0f-ac52-f88e4ba57ac8",
              layerType: "furniture",
            },
            {
              id: "a3ba8f96-8467-48d1-8021-763112125673",
              name: "LRT05-S07",
              furnitureId: "83382964-e41a-463f-b0e8-bf572b366a92",
              layerType: "furniture",
            },
            {
              id: "902e54b9-d99f-49b7-85c6-9a4ce0892427",
              name: "LRT05-S08",
              furnitureId: "583159f9-35fa-445f-8160-d8f487ca905f",
              layerType: "furniture",
            },
            {
              id: "ba3725df-9918-480e-bd36-92d73c55030f",
              name: "LRT05-S09",
              furnitureId: "6b90208e-015c-43f8-9681-62a282ae0560",
              layerType: "furniture",
            },
            {
              id: "40dc991a-bf01-411c-866e-ce428dd7fb23",
              name: "LRT05-S10",
              furnitureId: "19da1798-801a-4d1d-a539-d18286d32342",
              layerType: "furniture",
            },
            {
              id: "e07b0433-6dd4-4ee4-890c-f041860b4617",
              name: "LRT06-S01",
              furnitureId: "de5295c8-3708-444b-8146-8c3a2a7aa497",
              layerType: "furniture",
            },
            {
              id: "8de75d56-73e0-41fb-a877-c83055e9793e",
              name: "LRT06-S02",
              furnitureId: "e4863045-0369-4ea7-a569-05e1e9563c2a",
              layerType: "furniture",
            },
            {
              id: "9cd8ed21-5c7c-48e0-a60a-f2d8a9678b6d",
              name: "LRT06-S03",
              furnitureId: "d9a9baa3-8a6f-4ff1-a03d-3806ec50b1e1",
              layerType: "furniture",
            },
            {
              id: "f9247401-2ba2-4896-b31c-8d4e6927125f",
              name: "LRT06-S04",
              furnitureId: "7508be4a-aa73-418b-97ff-01fd2ea97ad6",
              layerType: "furniture",
            },
            {
              id: "9c53d86f-bfaa-4899-b7bd-d4aecff1d1aa",
              name: "LRT06-S05",
              furnitureId: "3b6402eb-7253-4ec7-9590-4c887ece8327",
              layerType: "furniture",
            },
            {
              id: "e1680f72-a5e0-4e37-a0e6-8c851dd5bc1f",
              name: "LRT06-S06",
              furnitureId: "af2a06a5-fe89-4fc2-b10e-bd6201610f11",
              layerType: "furniture",
            },
            {
              id: "05b730dc-30d1-465b-bce3-32aa509f8bc0",
              name: "LRT06-S07",
              furnitureId: "ed3f8463-b1c2-4bfd-a402-d7a2f5da302d",
              layerType: "furniture",
            },
            {
              id: "fd020198-efb6-4599-8186-450bceaf8586",
              name: "LRT06-S08",
              furnitureId: "4414b411-c46d-4591-84de-c6425550e7f6",
              layerType: "furniture",
            },
            {
              id: "eb0ca871-ad7c-4ca4-ae98-bd4deef602ab",
              name: "LRT06-S09",
              furnitureId: "cdcb4775-b712-4a16-a963-d1eccd922422",
              layerType: "furniture",
            },
            {
              id: "02e16118-e7f0-4b62-bbec-3fef12a66f4b",
              name: "LRT06-S10",
              furnitureId: "42cdb803-a7eb-4c08-8788-868b386b8fca",
              layerType: "furniture",
            },
          ],
        },
        {
    "id": "161eabd8-3a08-4b1a-b297-2829cf8b31ea",
    "name": "NonAccessibleArea",
    "type": "polygon",
    "assets": [
      {
        "id": "031bae15-7140-44c3-b06a-eb777de0ee23",
        "name": "1",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 127.09495926060765,
            "z": -29.874127926266816,
            "levelIndex": 0
          },
          {
            "x": 129.40664815623603,
            "z": -29.832682474959725,
            "levelIndex": 0
          },
          {
            "x": 129.39748408777228,
            "z": -30.531571447107098,
            "levelIndex": 0
          },
          {
            "x": 129.88976559721897,
            "z": -30.62411136593758,
            "levelIndex": 0
          },
          {
            "x": 129.9334135047775,
            "z": -32.830134199476504,
            "levelIndex": 0
          },
          {
            "x": 129.62028312944935,
            "z": -32.96193697086082,
            "levelIndex": 0
          },
          {
            "x": 129.70927327785276,
            "z": -47.97097604513364,
            "levelIndex": 0
          },
          {
            "x": 129.37968267560828,
            "z": -48.06256111610964,
            "levelIndex": 0
          },
          {
            "x": 129.46254318418877,
            "z": -57.21225631698373,
            "levelIndex": 0
          },
          {
            "x": 127.08817643121148,
            "z": -57.191591601045246,
            "levelIndex": 0
          },
          {
            "x": 127.12244038656172,
            "z": -56.46485969459966,
            "levelIndex": 0
          },
          {
            "x": 126.50511252290273,
            "z": -56.36316769827626,
            "levelIndex": 0
          },
          {
            "x": 126.47182634007848,
            "z": -48.64065028660267,
            "levelIndex": 0
          },
          {
            "x": 127.00905296499707,
            "z": -48.57224075094267,
            "levelIndex": 0
          },
          {
            "x": 127.0229934107732,
            "z": -47.64495656737104,
            "levelIndex": 0
          },
          {
            "x": 126.80645313039155,
            "z": -47.61691587101984,
            "levelIndex": 0
          },
          {
            "x": 126.84351165802427,
            "z": -31.21696597234341,
            "levelIndex": 0
          },
          {
            "x": 127.03537406269022,
            "z": -31.200337454167098,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "b8da8833-ac95-423a-a02b-04aa399172b0",
        "name": "2",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 95.78302906021794,
            "z": -52.6382124135164,
            "levelIndex": 0
          },
          {
            "x": 95.76357239429578,
            "z": -56.834324767553866,
            "levelIndex": 0
          },
          {
            "x": 99.605857214205,
            "z": -56.924469757080075,
            "levelIndex": 0
          },
          {
            "x": 99.71681864179328,
            "z": -57.24961624379931,
            "levelIndex": 0
          },
          {
            "x": 108.35728009974501,
            "z": -57.13241745273007,
            "levelIndex": 0
          },
          {
            "x": 108.34651753880514,
            "z": -56.52437437736579,
            "levelIndex": 0
          },
          {
            "x": 108.66162303936889,
            "z": -56.49233578123829,
            "levelIndex": 0
          },
          {
            "x": 108.6122813104602,
            "z": -54.183521320389616,
            "levelIndex": 0
          },
          {
            "x": 103.0084153046961,
            "z": -53.994190681249776,
            "levelIndex": 0
          },
          {
            "x": 102.90427061662842,
            "z": -52.61156634647163,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "69b05c6f-3259-47e2-ade5-8805ee7c3829",
        "name": "3",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 85.78491094786841,
            "z": -34.643697573520015,
            "levelIndex": 0
          },
          {
            "x": 87.59541834892808,
            "z": -33.23932656855018,
            "levelIndex": 0
          },
          {
            "x": 99.73140209177316,
            "z": -33.26026681558147,
            "levelIndex": 0
          },
          {
            "x": 99.71667112286589,
            "z": -34.664960493274144,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "064c5862-54b8-4c31-bb23-13e50b27b5e4",
        "name": "4",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 53.59507131105567,
            "z": -34.46673686490799,
            "levelIndex": 0
          },
          {
            "x": 51.58134583657915,
            "z": -33.14592098656412,
            "levelIndex": 0
          },
          {
            "x": 40.24196730040189,
            "z": -33.215770558838436,
            "levelIndex": 0
          },
          {
            "x": 40.04435067028177,
            "z": -34.46133705921055,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "4e7221ef-19ee-44e6-84ea-8a8ad43bfd4f",
        "name": "5",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 30.93217752595686,
            "z": -57.30693454101719,
            "levelIndex": 0
          },
          {
            "x": 30.835346996026338,
            "z": -54.103480281488885,
            "levelIndex": 0
          },
          {
            "x": 38.22302225659392,
            "z": -54.01819950335049,
            "levelIndex": 0
          },
          {
            "x": 38.24478425448908,
            "z": -52.69755122544387,
            "levelIndex": 0
          },
          {
            "x": 44.9019659609672,
            "z": -52.661771753807926,
            "levelIndex": 0
          },
          {
            "x": 45.351522506817545,
            "z": -57.00723934907044,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "2e5718f5-8b5e-4337-ba4f-c8aa3470488a",
        "name": "6",
        "levelIndex": 0,
        "coordinates": [
          [
            {
              "x": 90.582,
              "z": -61.883,
              "levelIndex": 0
            },
            {
              "x": 90.582,
              "z": -58.519,
              "levelIndex": 0
            },
            {
              "x": 90.133,
              "z": -58.519,
              "levelIndex": 0
            },
            {
              "x": 87.838,
              "z": -58.519,
              "levelIndex": 0
            },
            {
              "x": 87.838,
              "z": -61.883,
              "levelIndex": 0
            },
            {
              "x": 90.582,
              "z": -61.883,
              "levelIndex": 0
            }
          ]
        ],
        "layerType": "polygon",
        "mapped": true
      }
    ]
  },
  {
    "id": "ccb6b67b-5390-4fee-86da-e9b6719a7abf",
    "name": "Study Carrel",
    "type": "furniture",
    "assets": [
      {
        "id": "42bdca4d-fc80-4f55-a796-5bd031316ecf",
        "name": "1FN-S01",
        "furnitureId": "0462759d-67ad-4298-b03d-108aec5aa3df",
        "layerType": "furniture"
      },
      {
        "id": "8e4fbab5-9ba8-47dc-918a-af62fa1d947d",
        "name": "1FN-S02",
        "furnitureId": "825c9447-4ce0-43e9-9422-8640c2fe0889",
        "layerType": "furniture"
      },
      {
        "id": "0b4311cd-1db5-4f0f-b82e-dbacb09081dd",
        "name": "1FN-S03",
        "furnitureId": "0a8d7ecd-cbf4-4ab2-a79f-79ea51922e11",
        "layerType": "furniture"
      },
      {
        "id": "b5e712e1-d66a-403f-9cd8-27442d7f1ca0",
        "name": "1FN-S04",
        "furnitureId": "1fca3da0-2a42-4f4c-a24c-8accb0e02ade",
        "layerType": "furniture"
      },
      {
        "id": "1d656bd2-ef02-4dda-bb68-c2b7b6d7dda7",
        "name": "1FN-S05",
        "furnitureId": "7bea9b11-b08e-4181-8846-ad1963e992f5",
        "layerType": "furniture"
      },
      {
        "id": "6da6a986-cd38-4f29-9388-ccf290629c0e",
        "name": "1FS-S01",
        "furnitureId": "8dc6f5ee-7b9e-4b6a-8e2e-9ce9b72978f3",
        "layerType": "furniture"
      },
      {
        "id": "09b0f796-65a6-414e-8e6f-67f20f3c8f82",
        "name": "1FS-S02",
        "furnitureId": "eb1b8273-acb5-4c98-860f-df11379a460c",
        "layerType": "furniture"
      },
      {
        "id": "30ac0798-2e69-4f28-b03f-070086801fe0",
        "name": "1FS-S03",
        "furnitureId": "7f3a0e20-d8be-4c8a-9020-22a4bd1775b0",
        "layerType": "furniture"
      },
      {
        "id": "49f1be74-7048-4bd8-b79d-36dff73974fe",
        "name": "1FS-S04",
        "furnitureId": "26259612-d093-4f6d-bafd-f577161bf300",
        "layerType": "furniture"
      },
      {
        "id": "1d56a21a-d29f-44da-aed5-62070e1c0a10",
        "name": "1FS-S05",
        "furnitureId": "54fa9a6d-0602-404b-b0db-bd66cc58f082",
        "layerType": "furniture"
      }
    ]
  },
  {
    "id": "fa9b88ed-8719-4065-ae39-6ee3c4fc7ad4",
    "name": "Female Toilet",
    "type": "polygon",
    "assets": [
      {
        "id": "e7e8a617-9555-4885-a684-6a714e0a5366",
        "name": "1F-FT1",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 120.19204823559258,
            "z": -38.986321333157996,
            "levelIndex": 0
          },
          {
            "x": 120.2153457918169,
            "z": -40.720691360855604,
            "levelIndex": 0
          },
          {
            "x": 121.49655351294182,
            "z": -40.794853411995696,
            "levelIndex": 0
          },
          {
            "x": 121.60078803892276,
            "z": -41.93855510679391,
            "levelIndex": 0
          },
          {
            "x": 123.16344672078604,
            "z": -41.88976590180049,
            "levelIndex": 0
          },
          {
            "x": 123.2335951781173,
            "z": -43.751457885142244,
            "levelIndex": 0
          },
          {
            "x": 126.81231056920298,
            "z": -43.801717380151494,
            "levelIndex": 0
          },
          {
            "x": 126.69887053929737,
            "z": -39.005836669353066,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "919bd599-2cb0-44c2-8678-3a27cdb635c6",
        "name": "1F-FT2",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 12.901532503353817,
            "z": -39.46775986039414,
            "levelIndex": 0
          },
          {
            "x": 13.345291392740032,
            "z": -39.47654580306343,
            "levelIndex": 0
          },
          {
            "x": 13.353858027320875,
            "z": -39.09739041727277,
            "levelIndex": 0
          },
          {
            "x": 19.243839177949244,
            "z": -39.00596183533707,
            "levelIndex": 0
          },
          {
            "x": 19.30841376210651,
            "z": -40.715279752953236,
            "levelIndex": 0
          },
          {
            "x": 18.17417539345988,
            "z": -40.748333356734534,
            "levelIndex": 0
          },
          {
            "x": 17.975973237432417,
            "z": -41.94110574679643,
            "levelIndex": 0
          },
          {
            "x": 16.2475294443652,
            "z": -41.94455547044062,
            "levelIndex": 0
          },
          {
            "x": 16.170569907333064,
            "z": -43.75275685039022,
            "levelIndex": 0
          },
          {
            "x": 12.951214142733827,
            "z": -43.909334699094714,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      }
    ]
  },
  {
    "id": "0bf87936-b707-4af8-a216-e10fa7010988",
    "name": "Male Toilet",
    "type": "polygon",
    "assets": [
      {
        "id": "c32790ee-18b4-4b8f-9de6-1d51a4f1e304",
        "name": "1F-MT1",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 121.6130821435224,
            "z": -46.320303234209625,
            "levelIndex": 0
          },
          {
            "x": 121.5376911529984,
            "z": -43.976307724970006,
            "levelIndex": 0
          },
          {
            "x": 123.28626378725505,
            "z": -43.84391444247613,
            "levelIndex": 0
          },
          {
            "x": 126.75230516466799,
            "z": -43.78419125725849,
            "levelIndex": 0
          },
          {
            "x": 126.75091924436981,
            "z": -48.048910019920285,
            "levelIndex": 0
          },
          {
            "x": 120.19955537590404,
            "z": -48.13324466605371,
            "levelIndex": 0
          },
          {
            "x": 120.25748142229004,
            "z": -46.353371591809506,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "e888497f-f7ca-4f0a-9935-c2bfd19910e3",
        "name": "1F-MT2",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 19.344648878694116,
            "z": -46.307237216903815,
            "levelIndex": 0
          },
          {
            "x": 19.38513378420795,
            "z": -48.14619378598523,
            "levelIndex": 0
          },
          {
            "x": 13.543446520191317,
            "z": -48.07900925414867,
            "levelIndex": 0
          },
          {
            "x": 13.426205893634235,
            "z": -47.71540100638392,
            "levelIndex": 0
          },
          {
            "x": 12.831142703753674,
            "z": -47.62876507976249,
            "levelIndex": 0
          },
          {
            "x": 12.791476201677984,
            "z": -46.490832005186576,
            "levelIndex": 0
          },
          {
            "x": 12.78154982481566,
            "z": -43.82581992637224,
            "levelIndex": 0
          },
          {
            "x": 16.184186213192806,
            "z": -43.84850670816415,
            "levelIndex": 0
          },
          {
            "x": 17.958917318635002,
            "z": -43.8744913402136,
            "levelIndex": 0
          },
          {
            "x": 18.11593593503706,
            "z": -46.812081838578045,
            "levelIndex": 0
          },
          {
            "x": 18.211187303767506,
            "z": -46.77294565021207,
            "levelIndex": 0
          },
          {
            "x": 18.09088837312673,
            "z": -46.3430704939609,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      }
    ]
  },
  {
    "id": "8ced3f65-7f4d-483f-a336-a6de087fdb01",
    "name": "UniToilet/Accsessible",
    "type": "polygon",
    "assets": [
      {
        "id": "ca50785a-4d4a-42ea-8b2c-0f4b5dbda2fe",
        "name": "1F-UT1",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 121.57519270247762,
            "z": -42.12699848691775,
            "levelIndex": 0
          },
          {
            "x": 121.53639668448415,
            "z": -43.96842133516502,
            "levelIndex": 0
          },
          {
            "x": 123.35977959404207,
            "z": -43.89222275788863,
            "levelIndex": 0
          },
          {
            "x": 123.2335951781173,
            "z": -42.08118362494424,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "4a51eb6f-f98b-4a27-8aa2-5ac7048d8c2f",
        "name": "1F-UT2",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 16.28269345433077,
            "z": -42.038050970366285,
            "levelIndex": 0
          },
          {
            "x": 16.253428958129824,
            "z": -43.838201248204896,
            "levelIndex": 0
          },
          {
            "x": 17.956350925799022,
            "z": -43.83142521203729,
            "levelIndex": 0
          },
          {
            "x": 17.956140189026986,
            "z": -41.9210025662495,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      },
      {
        "id": "81bb538b-fe4a-420e-aad2-3287e9884c70",
        "name": "1F-UT3",
        "levelIndex": 0,
        "coordinates": [
          {
            "x": 45.33613836543136,
            "z": -52.71431250472744,
            "levelIndex": 0
          },
          {
            "x": 45.30807229419784,
            "z": -56.89978798505507,
            "levelIndex": 0
          },
          {
            "x": 48.12954502037499,
            "z": -56.91705109465889,
            "levelIndex": 0
          },
          {
            "x": 48.153194351105896,
            "z": -56.55651563032705,
            "levelIndex": 0
          },
          {
            "x": 49.14175588432118,
            "z": -56.596560211335124,
            "levelIndex": 0
          },
          {
            "x": 49.11992577888062,
            "z": -55.29648475597611,
            "levelIndex": 0
          },
          {
            "x": 48.53888865235198,
            "z": -55.29377103230139,
            "levelIndex": 0
          },
          {
            "x": 48.538888677691624,
            "z": -53.57583391142757,
            "levelIndex": 0
          },
          {
            "x": 49.124034197090424,
            "z": -53.57221105333184,
            "levelIndex": 0
          },
          {
            "x": 49.14354579910975,
            "z": -52.563955110967974,
            "levelIndex": 0
          },
          {
            "x": 45.490257070047214,
            "z": -52.625084903254645,
            "levelIndex": 0
          }
        ],
        "layerType": "polygon",
        "mapped": true
      }
    ]
  }
      ];

      const color_dict = {
        occupied: "#ff3f34",
        countdown: "#ff3f34",
        vacant: "#3aa655",
        free: "#3aa655",
        unoccupied: "#3aa655",
        passive_occupied: "#ffbf00",
        away: "#ffbf00",
        demo: "#6888be",
        unavailable: "#768590",
        };

      // smplrspace-script.js
class Space {
  constructor(spaceId, clientToken, desks, rooms, sensors, Notaccessible, toiletAreas) {
    this.spaceId = spaceId;
    this.clientToken = clientToken;
    this.space = null;
    this.rooms = rooms;
    this.desks = desks;
    this.sensors = sensors;
    this.Notaccessible = Notaccessible;
    this.toiletAreas = toiletAreas;

  }

  initSpace(smplr) {
    this.space = new smplr.Space({
      spaceId: this.spaceId,
      clientToken: this.clientToken,
      containerId: "smplrspace-container",
    });
    this.space.startViewer({
      preview: false,
      cameraPlacement: {
        alpha: Math.PI / 2,
        beta: 0.5,
        radius: 24,
        target: {
          x: 70,
          y: 1,
          z: -51,
        },
      },
      onReady: () => this.fetchAll(),
      onError: (error) => console.error("Could not start viewer", error),
    });
  }

  updateDataLayers() {
    // remove previous layers if any
    this.space.removeDataLayer("rooms");
    this.space.removeDataLayer("desks");
    this.space.removeDataLayer("Notaccessible");
    this.space.removeDataLayer("toiletAreas");

    const isRoomsEmpty = !this.rooms || this.rooms.length === 0;
    const isDesksEmpty = !this.desks || this.desks.length === 0;
    const isNotaccessibleEmpty = !this.Notaccessible || this.Notaccessible.length === 0;
    const isToiletAreasEmpty = !this.toiletAreas || this.toiletAreas.length === 0;

    if (!isRoomsEmpty) {
      // add new layers
      this.space.addDataLayer({
        id: "rooms",
        type: "polygon",
        data: this.rooms,
        tooltip: (d) => `${d.name} - ${d.available}`,
        color: (d) => d.color,
        alpha: 0.7,
        height: 2.9,
      });
    }

    if (!isDesksEmpty) {
      this.space.addDataLayer({
        id: "desks",
        type: "furniture",
        data: this.desks,
        tooltip: (d) => `${d.name} - ${d.available}`,
        color: (d) => d.color,
      });
    }

    if (!isNotaccessibleEmpty) {
      this.space.addDataLayer({
        id: "Notaccessible",
        type: "polygon",
        data: this.Notaccessible,
        tooltip: (d) => ` ${d.available}`,
        color: (d) => d.color,
        alpha: 2.6,
        height: 2.9,
      });
    }

    if (!isToiletAreasEmpty) {
      this.space.addDataLayer({
        id: "toiletAreas",
        type: "polygon",
        data: this.toiletAreas,
        tooltip: (d) => `${d.available}`,
        color: (d) => d.color,
        alpha: 2.7,
        height: 2.9,
      });
    }
  }

  fetchAll() {
    this.fetchData();
  }

  fetchData() {
    fetch(API_ENDPOINT)
      .then((res) => res.json())
      .then((data) => {
        let occupancy = {};
        for (let i = 0; i < data.length; i++) {
          let value = data[i];
          let loc = value.area;
          let timestamp = value.timestamp;
          let available = value.occupancy;

          let color = color_dict.hasOwnProperty(available)
            ? color_dict[available]
            : "#ffffff";

          if (!occupancy.hasOwnProperty(loc)) {
            occupancy[loc] = {
              timestamp: timestamp,
              available: available,
              occupancy: value.occupancy,
              color: color,
            };
          } else if (occupancy[loc].timestamp < timestamp) {
            occupancy[loc] = {
              timestamp: timestamp,
              available: available,
              occupancy: value.occupancy,
              color: color,
            };
          }
        }

        for (let key in occupancy) {
          if (
            occupancy.hasOwnProperty(key) &&
            desk_filter.hasOwnProperty(key)
          ) {
            const jsonKey = desk_filter[key];
            const _index = desk_index[jsonKey];

            this.desks[_index]["available"] = occupancy[key]["available"];
            this.desks[_index]["color"] = occupancy[key]["color"];
          } else if (
            occupancy.hasOwnProperty(key) &&
            room_filter.hasOwnProperty(key)
          ) {
            const jsonKey = room_filter[key];
            const _index = room_index[jsonKey];

            if (this.rooms && this.rooms[_index]) {
              this.rooms[_index]["available"] = occupancy[key]["available"];
              this.rooms[_index]["numberOfPeople"] =
                occupancy[key]["numberOfPeople"];
              this.rooms[_index]["color"] = occupancy[key]["color"];
            }
          } else if (
            occupancy.hasOwnProperty(key) &&
            color_overlay_filter.hasOwnProperty(key)
          ) {
            const jsonKey = color_overlay_filter[key];
            const _index = color_overlay_index[jsonKey];

            if (this.Notaccessible && this.Notaccessible[_index]) {
              this.Notaccessible[_index]["available"] = occupancy[key]["available"];
              this.Notaccessible[_index]["color"] = occupancy[key]["color"];
            }
          }
        }
        this.updateDataLayers();
      });
  }
}

// initialize with the new Not Accessivble assets
const Notaccessible = dict[1]["assets"].map(area => {

    return {
      ...area,
      available: "Not Accessible",
      color: color_dict["unavailable"]
    };
  }
);

// Initialize with the toilet areas with specific colors
const toiletAreas = [
 
  ...dict[3]["assets"].map(area => {
    return {
      ...area,
      available: "Female Toilet",
      color: "#A7384E"
    };
  }),
  
 
  ...dict[4]["assets"].map(area => {
    return {
      ...area,
      available: "Male Toilet",
      color: "#1D547D"
    };
  }),
  
  // UniToilet/Accessible - green
  ...dict[5]["assets"].map(area => {
    return {
      ...area,
      available: "UniToilet/Accessible",
      color: "#3aa655" 
    };
  })
];


// Create the Space instance with the updated parameters
spc = new Space(SPACE_ID, CLIENT_ID,  [...dict[0]["assets"], ...dict[2]["assets"]], [], [], Notaccessible, toiletAreas);

delete dict;

async function wait() {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve();
    }, 500);
  });
}

async function start() {
  while (typeof smplr === "undefined") {
    await wait();
  }
  spc.initSpace(smplr);
  setInterval(() => {
    spc.fetchAll();
  }, UPDATE_FREQUENCY * 1000);
}

start();
    </script>
  </body>
</html>
