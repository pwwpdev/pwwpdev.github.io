<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Alert Example</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      input {
        padding: 10px;
        margin-right: 10px;
      }
      button {
        padding: 10px;
      }
    </style>
    <script src="https://app.smplrspace.com/lib/smplr.js"></script>
    <link href="https://app.smplrspace.com/lib/smplr.css" rel="stylesheet" />
  </head>
  <body>
    <!-- <h1>1st Floor Book</h1>
    <input type="text" id="userInput" placeholder="Enter some text" />
    <button id="alertButton" onclick="alert_input()">Locate</button>
    <br />
    <br /> -->
    <div id="wrapper">
      <div class="smplr-wrapper">
        <div id="test" class="smplr-embed"></div>
      </div>
    </div>
    <script>
      const API_ENDPOINT = "https://optimusc.flowfuse.cloud/map-2";
      const CLIENT_ID = "pub_45cf413215bd43f79621e0b28f8a815b";
      const SPACE_ID = "spc_vyvqclk6";

      const space = new smplr.Space({
        spaceId: SPACE_ID,
        clientToken: CLIENT_ID,
        containerId: "test",
      });

      const book_shelves_raw = [
        {
          id: "1727459a-e8cc-4263-8bbc-2def247d5285",
          name: "2A01",
          furnitureId: "c55bbbeb-3b46-416a-a0db-72da7a02c088",
          layerType: "furniture",
        },
        {
          id: "60accb8b-e47c-4d4f-b6ef-5a37d4a413a1",
          name: "2A02",
          furnitureId: "786e3c28-b5fc-4c22-a8c7-77140c8e05da",
          layerType: "furniture",
        },
        {
          id: "2b5a2bf9-7bd3-4ae0-8872-ff4ca0b026e9",
          name: "2A03",
          furnitureId: "324cb7c4-9bed-4d69-872b-a555490cca1a",
          layerType: "furniture",
        },
        {
          id: "0068d637-9ed9-4297-b4c4-3ef1589d8bee",
          name: "2A04",
          furnitureId: "cae6debd-4d18-4fc8-a4d2-e51fc7e56c2b",
          layerType: "furniture",
        },
        {
          id: "fbaeaa0d-cb98-4678-a2e8-752234e4989b",
          name: "2A05",
          furnitureId: "f8561d0d-a792-4291-976c-cd97420c9fb3",
          layerType: "furniture",
        },
        {
          id: "a248058a-d1b7-4260-9181-c6b8a662a91d",
          name: "2A06",
          furnitureId: "ac652397-6719-4761-82c8-41cd6feda332",
          layerType: "furniture",
        },
        {
          id: "3bcc8aeb-b7ea-4d0d-b125-140e47d27c47",
          name: "2A07",
          furnitureId: "94860a18-4475-4d98-9171-b72638dcf712",
          layerType: "furniture",
        },
        {
          id: "e260d647-69c9-4d22-873f-e9a56381e836",
          name: "2A08",
          furnitureId: "6cb338b0-3cd9-413d-af3f-e38b6469809c",
          layerType: "furniture",
        },
        {
          id: "50a90140-ba34-4c64-b39a-33d60bc7a4d3",
          name: "2A09",
          furnitureId: "917cd55f-143a-46b9-931a-668e2c516aac",
          layerType: "furniture",
        },
        {
          id: "4115810e-573f-4c66-91fd-74ed0186ae09",
          name: "2A10",
          furnitureId: "3a7974f2-15a0-4c62-b3c3-40361aa43c16",
          layerType: "furniture",
        },
        {
          id: "02adc9df-0fd7-485b-ac1d-f06e672079e7",
          name: "2A11",
          furnitureId: "96e21748-6676-46db-ab9d-6c7b1f92200c",
          layerType: "furniture",
        },
        {
          id: "26102806-3235-4c08-9bc1-2632cad41e1e",
          name: "2A12",
          furnitureId: "9f31aafd-20f2-4866-8433-bc4b3baf51f0",
          layerType: "furniture",
        },
        {
          id: "020c961b-4e35-4c23-bda1-044efb59ac05",
          name: "2A13",
          furnitureId: "67e72ce6-c7ae-495e-a118-abb105a7e536",
          layerType: "furniture",
        },
        {
          id: "3e466842-9de8-49c3-b020-e6ec3a0fded5",
          name: "2A14",
          furnitureId: "fc91e751-f7b3-4856-92cd-89ddbcba1c02",
          layerType: "furniture",
        },
        {
          id: "b00235d4-d5a3-4bdb-9ee1-d481fcfac7e0",
          name: "2A15",
          furnitureId: "872efea0-72f9-4f09-9e81-88ba15c8271e",
          layerType: "furniture",
        },
        {
          id: "339d7ec5-8a3e-47a6-a27c-ecb75791c428",
          name: "2A16",
          furnitureId: "960c01a1-7ae3-45c2-9eda-3023b6442fa2",
          layerType: "furniture",
        },
        {
          id: "0cc0920b-f058-4aa9-81aa-fc52fd995317",
          name: "2B01",
          furnitureId: "92a9b2ac-cdfa-479f-8dda-6635d58bf1ba",
          layerType: "furniture",
        },
        {
          id: "6b29764c-ec9c-4c2e-9fbd-f2e5aba99ed1",
          name: "2B02",
          furnitureId: "b2766e86-0806-4007-8ade-23aa0c6f506d",
          layerType: "furniture",
        },
        {
          id: "3999a195-727f-4c0d-97d8-c18a91eb950a",
          name: "2B03",
          furnitureId: "2418b769-ef4d-4477-ae6e-0ca4de40149f",
          layerType: "furniture",
        },
        {
          id: "ec949863-6901-4c9c-b81b-2746fff018c5",
          name: "2C01",
          furnitureId: "145e5cc3-397e-4033-8e31-ece819adacae",
          layerType: "furniture",
        },
        {
          id: "1d015d63-1ceb-4687-a73e-5a1fb6f6611f",
          name: "2C02",
          furnitureId: "0cfea22c-3348-48a1-8594-71c13f39bf1b",
          layerType: "furniture",
        },
        {
          id: "8cfaa9f7-0f23-4700-9a57-70272590ecec",
          name: "2C03",
          furnitureId: "74064f90-d461-41c6-8028-227d1d00e141",
          layerType: "furniture",
        },
        {
          id: "c7b2de7d-0c7f-470b-b9b6-d6e076e0d0e1",
          name: "2C04",
          furnitureId: "9fab116b-2659-4d02-81e4-bc73a85e7ba2",
          layerType: "furniture",
        },
        {
          id: "4e3187fb-c4f9-4be3-a599-9276615d23ef",
          name: "2C05",
          furnitureId: "3ef34bab-a2cb-4f02-b4a0-1965d7397a3c",
          layerType: "furniture",
        },
        {
          id: "e63233e1-c9aa-40fe-8eb1-f9840763dbad",
          name: "2C06",
          furnitureId: "2a11f3db-70ca-4c30-9f3a-4405bbfb17f0",
          layerType: "furniture",
        },
        {
          id: "e90f59a3-46fd-48b9-857d-11271ab512f9",
          name: "2C07",
          furnitureId: "9d6357e7-38e5-4cb3-ac37-49030cec0e8a",
          layerType: "furniture",
        },
        {
          id: "d7a94605-10d4-4185-b4c3-90f5834f67a1",
          name: "2C08",
          furnitureId: "2458dc8d-a511-45b9-a7e4-4725910e0e11",
          layerType: "furniture",
        },
        {
          id: "0b3184e4-2c23-4b50-9cc8-bdcb2b2b0f0b",
          name: "2C09",
          furnitureId: "12a84d00-67fa-429e-8894-a9eec7482196",
          layerType: "furniture",
        },
        {
          id: "94b5b0fe-701c-4604-ac8d-c3e53a45966d",
          name: "2C10",
          furnitureId: "b000fe3e-e354-4868-a6e6-f282d8be9d50",
          layerType: "furniture",
        },
        {
          id: "cba708b6-0814-4d78-96a9-c48d0e7b922d",
          name: "2C11",
          furnitureId: "9e5e5f47-682c-41bf-b817-8cd2c0933c55",
          layerType: "furniture",
        },
        {
          id: "5120890d-86e5-48fd-b0c4-58ff014a5312",
          name: "2C12",
          furnitureId: "7956beae-3335-4ca2-88d1-f75ea4ab5c43",
          layerType: "furniture",
        },
        {
          id: "3908f14b-c6a7-4f0c-8b6d-d705c6f0e69e",
          name: "2C13",
          furnitureId: "3ca8bbe4-015b-4ab3-ad9b-0168ad010552",
          layerType: "furniture",
        },
        {
          id: "a53fce80-8e8e-4d41-bbf1-4cc12013f483",
          name: "2C14",
          furnitureId: "b5666417-21ef-4fec-99c0-9c492a633074",
          layerType: "furniture",
        },
        {
          id: "733e7731-094c-48d9-899a-1d25f5dfd75a",
          name: "2C15",
          furnitureId: "27e78ede-8a5c-45f9-b1b0-4f79aa47b9ba",
          layerType: "furniture",
        },
        {
          id: "d859b6e8-343a-4adc-9b94-f5ed0fa256f3",
          name: "2A17",
          furnitureId: "8a029e32-5149-42ce-a809-444f883efbf8",
          layerType: "furniture",
        },
      ];

      let book_shelves = {};

      for (let i = 0; i < book_shelves_raw.length; i++) {
        let name = book_shelves_raw[i]["name"];
        book_shelves[name] = book_shelves_raw[i];
      }

      function getQueryParameter(param) {
        // Get the current URL
        const url = new URL(window.location.href);

        // Use URLSearchParams to get the value of the specified parameter
        const value = url.searchParams.get(param);

        return value;
      }

      async function alert_input() {
        // Example usage
        const paramName = "callNumber"; // Replace with your query parameter name
        const inputText = getQueryParameter(paramName);
        // Get the value from the input field
        //        var inputText = document.getElementById("userInput").value;
        // Show the input text in an alert
        let display = [];
        await fetch(`${API_ENDPOINT}?locationCode=2f&callNumber=${inputText}`)
          .then((d) => {
            return d.json();
          })
          .then((data) => {
            try {
              for (let i = 0; i < data.length; i++) {
                if (data[i] in book_shelves) {
                  display.push(book_shelves[data[i]]);
                }
              }
              for (let i = 0; i < 2; i++) {
                if (data.length > 0) {
                  document.getElementById("wrapper").style.display = "block";

                  if (data[0].startsWith("1FN")) {
                    space.setCameraPlacement({
                      alpha: -4.7267296580715765,
                      beta: 0.6382428340579139,
                      radius: 32.421042896849265,
                      target: {
                        x: 31.3579622603224,
                        y: 3,
                        z: -38.0152734222641,
                      },
                      animated: true,
                    });
                  } else if (data[0].startsWith("1FC")) {
                    space.setCameraPlacement({
                      alpha: -4.703992296083447,
                      beta: 0.5084628431956129,
                      radius: 17.490514084085667,
                      target: {
                        x: 71.3579622603224,
                        y: 3,
                        z: -52.0152734222641,
                      },
                      animated: true,
                    });
                  } else if (data[0].startsWith("1FS")) {
                    space.setCameraPlacement({
                      alpha: -1.566476489307028,
                      beta: 0.569109451364136,
                      radius: 44.66302138247244,
                      target: {
                        x: 110.3579622603224,
                        y: 3,
                        z: -42.0152734222641,
                      },
                      animated: false,
                    });
                  }
                } else {
                  document.getElementById("wrapper").style.display = "none";
                  space.setCameraPlacement({
                    alpha: -1.5707963267948966,
                    beta: 0.7853981633974483,
                    radius: 76.60970531509193,
                    target: { x: 71.3579622603224, y: 3, z: -48.0152734222641 },
                    animated: true,
                  });
                }
              }

              space.removeDataLayer("bookshelves");

              space.addDataLayer({
                id: "bookshelves",
                type: "furniture",
                data: display,
                tooltip: (d) => `${d.name}`,
                color: (d) => "#50b268",
              });
            } catch (error) {
              console.log(error);
            }
          })
          .catch((error) => {
            // Handle any errors
            console.error(
              "There was a problem with the fetch operation:",
              error
            );
          });
      }

      space.startViewer({
        preview: false,
        allowModeChange: true,
        onReady: () => {
          alert_input();
        },
        onError: (error) => console.error("Could not start viewer", error),
      });
    </script>
  </body>
</html>
